window.addEventListener('load',function(){
    (function(){
    var chart2 = echarts.init(document.querySelector('.mainbox .chart2'));    

    var data=[
    {"stock":"月就诊天数_MAX","fundPost":"246"},
    {"stock":"月统筹金额_MAX","fundPost":"237"},
    {"stock":"一天去两家医院的天数","fundPost":"162"},
    {"stock":"药品费自费金额_SUM","fundPost":"108"},
    {"stock":"顺序号_NN","fundPost":"106"},
    {"stock":"医院_就诊天数_MAX","fundPost":"102"},
    {"stock":"贵重药品发生金额_SUM","fundPost":"90"},
    {"stock":"ALL_SUM","fundPost":"79"},
    {"stock":"治疗费发生金额_SUM","fundPost":"69"}
    ]
  function contains(arr, dst) {
        var i = arr.length;
        while ((i -= 1)) {
          if (arr[i] == dst) {
            return i;
          }
        }
        return false;
      }

    
      var attackSourcesColor = [
        new echarts.graphic.LinearGradient(0, 1, 1, 1, [
          { offset: 0, color: "#EB3B5A" },
          { offset: 1, color: "#FE9C5A" }
        ]),
        new echarts.graphic.LinearGradient(0, 1, 1, 1, [
          { offset: 0, color: "#FA8231" },
          { offset: 1, color: "#FFD14C" }
        ]),
        new echarts.graphic.LinearGradient(0, 1, 1, 1, [
          { offset: 0, color: "#F7B731" },
          { offset: 1, color: "#FFEE96" }
        ]),
        new echarts.graphic.LinearGradient(0, 1, 1, 1, [
          { offset: 0, color: "#395CFE" },
          { offset: 1, color: "#2EC7CF" }
        ])
      ];
      var attackSourcesColor1 = [
        "#EB3B5A",
        "#FA8231",
        "#F7B731",
        "#3860FC",
        "#1089E7",
        "#F57474",
        "#56D0E3",
        "#1089E7",
        "#F57474",
        "#1089E7",
        "#F57474"
      ];
      var attaData = [];
      var attaName = [];
      var topName=[]
      data.forEach((it, index) => {
        attaData[index] = parseFloat(it.fundPost).toFixed(2);
        attaName[index] = it.stock;
        topName[index] = `${it.code} ${it.stock}`
      });
      var salvProMax = []; //背景按最大值
      for (let i = 0; i < attaData.length; i++) {
        salvProMax.push(attaData[0]);
      }
      function attackSourcesDataFmt(sData) {
        var s = [];
        sData.forEach(function(item, i) {
          let itemStyle = {
            color: i > 3 ? attackSourcesColor[3] : attackSourcesColor[i]
          };
          s.push({
            value: item,
            itemStyle: itemStyle
          });
        });
        return s;
      }

      var option2 = {
        tooltip: {
          show: false,
          backgroundColor: "rgba(3,169,244, 0.5)", 
          textStyle: {
            fontSize: 16
          }
        },
        color: ["#F7B731"],
        legend: {
          pageIconSize: [12, 12],
          itemWidth: 20,
          itemHeight: 10,
          left: '35%',
          textStyle: {
            fontSize: 15,
            color: "#fff"
          },
          selectedMode: false,
        },
        grid: {
          left: "5%",
          right: "2%",
          width:"80%",
          bottom: "2%",
          top: "8%",
          containLabel: true
        },
        xAxis: {
          type: "value",

          splitLine: {
            show: false
          },
          axisLabel: {
            show: false
          },
          axisTick: {
            show: false
          },
          axisLine: {
            show: false
          }
        },
        yAxis: [
          {
            type: "category",
            inverse: true,
            axisLine: {
              show: false
            },
            axisTick: {
              show: false
            },
            axisPointer: {
              label: {
                show: true,
                //margin: 30
              }
            },
            postion: "right",
            data: attaName,
            axisLabel: {
              margin: 30,
              fontSize: 10,
              align: "left",
              padding: [2, 0, 0, 0],
              color: "#000",
              rich: {
                nt1: {
                  color: "#fff",
                  backgroundColor: attackSourcesColor1[0],
                  width: 13,
                  height: 13,
                  fontSize: 10,
                  align: "center",
                  borderRadius: 100,
                  lineHeight: "5",
                  padding: [0, 1, 2, 1]
                  // padding:[0,0,2,0],
                },
                nt2: {
                  color: "#fff",
                  backgroundColor: attackSourcesColor1[1],
                  width: 13,
                  height: 13,
                  fontSize: 10,
                  align: "center",
                  borderRadius: 100,
                  padding: [0, 1, 2, 1]
                },
                nt3: {
                  color: "#fff",
                  backgroundColor: attackSourcesColor1[2],
                  width: 13,
                  height: 13,
                  fontSize: 10,
                  align: "center",
                  borderRadius: 100,
                  padding: [0, 1, 2, 1]
                },
                nt: {
                  color: "#fff",
                  backgroundColor: attackSourcesColor1[3],
                  width: 13,
                  height: 13,
                  fontSize: 10,
                  align: "center",
                  lineHeight: 3,
                  borderRadius: 100,
                  padding: [0, 1, 2, 1],
                  lineHeight: 5
                }
              },
              formatter: function(value, index) {
                index = contains(attaName, value) + 1;
                if (index - 1 < 3) {
                  return ["{nt" + index + "|" + index + "}"].join("\n");
                } else {
                  return ["{nt|" + index + "}"].join("\n");
                }
              }
            }
          },
          {
            type: "category",
            inverse: true,
            axisTick: "none",
            axisLine: "none",
            show: true,
            axisLabel: {
              textStyle: {
                color: "#fff",
                fontSize: "10"
              }
            },
            data: attackSourcesDataFmt(attaName)
          },
        ],
        series: [
          {
            zlevel: 1,
            name: "所确定的特征以及重要性",
            type: "bar",
            barWidth: "15px",
            barColor: '#44EAFC',
            color:'#44EAFC',
            animationDuration: 1500,
            data: attackSourcesDataFmt(attaData),
            align: "center",
            itemStyle: {
              normal: {
                barBorderRadius: 10
              }
            },
            label: {
              show: true,
              fontSize: 10,
              color: "#fff",
              textBorderWidth: 2,
              padding: [2, 0, 0, 0]
            }
          },
          {
            name: "所确定的特征以及重要性",
            type: "bar",
            barWidth: 15,
            barGap: "-100%",
            margin: "20",
            data: salvProMax,
            textStyle: {
              fontSize: 10,
              color: "#44EAFC"
            },
            itemStyle: {
              normal: {
                color: "#05325F",
                //width:"100%",
                fontSize: 10,
                barBorderRadius: 30
              },
            }
          }
        ]
      };
chart2.setOption(option2);
    })();

    (function(){
      var chart1 = echarts.init(document.querySelector('.mainbox .chart1'));
      
      var featureNames = [
    '个人编码',
    '一天去两家医院的天数',
    '就诊的月数',
    '月就诊天数_MAX',
    '月就诊天数_AVG',
    '月就诊医院数_MAX',
    '月就诊医院数_AVG',
    '就诊次数_SUM',
    '月就诊次数_MAX',
    '月就诊次数_AVG',
    '月统筹金额_MAX',
    '月统筹金额_AVG',
    '月药品金额_MAX',
    '月药品金额_AVG',
    '医院_就诊天数_MAX',
    '医院_就诊天数_AVG',
    '医院_统筹金_MAX',
    '医院_统筹金_AVG',
    '医院_药品_MAX',
    '医院_药品_AVG',
    '医院编码_NN',
    '顺序号_NN',
    '交易时间DD_NN'
];

var correlationCoefficients = [
    [1,-0.037209477, -0.031627309, -0.029969226, -0.032099883, -0.06604073, -0.067301332, -0.041032042, -0.037056193, -0.037859103, 0.066837727, 0.059420078, 0.042364197, 0.035352815, -0.022321527, -0.005090846, 0.07477263, 0.078667159, 0.056617276, 0.064182136, -0.062017348, -0.025807721, -0.035230902],
    [ -0.037209477, 1, 0.084152523, 0.344111732, 0.336584431, 0.481108558, 0.54659617, 0.452818056, 0.454358315, 0.454434973, 0.298473826, 0.329198996, 0.325916554, 0.352338444, 0.21466924, 0.113717428, 0.035302896, -0.06984772, 0.053981204, -0.050681711, 0.456577608, 0.424759669, 0.335995307],
    [-0.031627309, 0.084152523, 1, 0.177892073, 0.201464559, 0.116925416, 0.129903139, 0.320169458, 0.17792492, 0.201751004, 0.094290903, 0.119636941, 0.128134332, 0.15784507, 0.309419801, 0.293670641, 0.23453535, 0.204300778, 0.27178506, 0.236958882, 0.093382455, 0.321539451, 0.323802347],
    [ -0.029969226, 0.344111732, 0.177892073, 1, 0.950718114, 0.392131808, 0.417992369, 0.92490922, 0.979538552, 0.941059974, 0.427132578, 0.47233931, 0.364176494, 0.401240366, 0.801687535, 0.60930742, 0.257546419, 0.111711434, 0.20094303, 0.074228811, 0.364607193, 0.840245342, 0.932678657],
    [ -0.032099883, 0.336584431, 0.201464559, 0.950718114, 1, 0.369092595, 0.420879276, 0.968573674, 0.934882508, 0.985060102, 0.381817304, 0.489678001, 0.32383312, 0.422232342, 0.857478846, 0.672938853, 0.282296878, 0.147689932, 0.228524712, 0.114022752, 0.335408175, 0.880133867, 0.981607364],
    [ -0.06604073, 0.481108558, 0.116925416, 0.392131808, 0.369092595, 1, 0.920252036, 0.422834476, 0.45289101, 0.427893323, 0.234115944, 0.22653978, 0.287097318, 0.27870104, 0.032238407, -0.312647195, -0.215576109, -0.551626215, -0.169559089, -0.523255959, 0.962550066, 0.358823653, 0.364752206],
    [ -0.067301332, 0.54659617, 0.129903139, 0.417992369, 0.420879276, 0.920252036, 1, 0.48166923, 0.484004008, 0.488009317, 0.243741065, 0.269458295, 0.300559544, 0.323436303, 0.045921671, -0.197523176, -0.234574405, -0.461261728, -0.190218418, -0.431020317, 0.88573322, 0.413549443, 0.41543595],
    [ -0.041032042, 0.452818056, 0.320169458, 0.92490922, 0.968573674, 0.422834476, 0.48166923, 1, 0.935620423, 0.982666086, 0.39186702, 0.496245409, 0.346581158, 0.442619331, 0.849386832, 0.659266498, 0.283535046, 0.137941771, 0.241602847, 0.114922688, 0.387175456, 0.913184911, 0.985587773],
    [ -0.037056193, 0.454358315, 0.17792492, 0.979538552, 0.934882508, 0.45289101, 0.484004008, 0.935620423, 1, 0.952888975, 0.446174818, 0.488544234, 0.388675202, 0.422889071, 0.773292682, 0.571936997, 0.234090323, 0.076217356, 0.181581637, 0.041649415, 0.42267961, 0.850440798, 0.916604847],
    [ -0.037859103, 0.454434973, 0.201751004, 0.941059974, 0.985060102, 0.427893323, 0.488009317, 0.982666086, 0.952888975, 1, 0.402841771, 0.508762366, 0.348730291, 0.44528163, 0.830396372, 0.638785467, 0.259827568, 0.11520273, 0.208577168, 0.083754306, 0.391948715, 0.893436341, 0.966722063],
    [ 0.066837727, 0.298473826, 0.094290903, 0.427132578, 0.381817304, 0.234115944, 0.243741065, 0.39186702, 0.446174818, 0.402841771, 1, 0.911877107, 0.833437911, 0.753401483, 0.284581516, 0.207250123, 0.676016451, 0.496863446, 0.550935705, 0.396325292, 0.219786814, 0.480582062, 0.370159735],
    [ 0.059420078, 0.329198996, 0.119636941, 0.47233931, 0.489678001, 0.22653978, 0.269458295, 0.496245409, 0.488544234, 0.508762366, 0.911877107, 1, 0.766462382, 0.841075627, 0.391396659, 0.318716399, 0.749692725, 0.56591734, 0.623214707, 0.466366361, 0.201543093, 0.585314249, 0.47645679],
    [ 0.042364197, 0.325916554, 0.128134332, 0.364176494, 0.32383312, 0.287097318, 0.300559544, 0.346581158, 0.388675202, 0.348730291, 0.833437911, 0.766462382, 1, 0.909077549, 0.225144559, 0.149560634, 0.541673874, 0.378939516, 0.665520863, 0.477956743, 0.265412117, 0.428768399, 0.321115768],
    [ 0.035352815, 0.352338444, 0.15784507, 0.401240366, 0.422232342, 0.27870104, 0.323436303, 0.442619331, 0.422889071, 0.44528163, 0.753401483, 0.841075627, 0.909077549, 1, 0.322000862, 0.250969646, 0.606171481, 0.441395312, 0.742936829, 0.550707093, 0.247454581, 0.522001384, 0.419011086],
    [ -0.022321527, 0.21466924, 0.309419801, 0.801687535, 0.857478846, 0.032238407, 0.045921671, 0.849386832, 0.773292682, 0.830396372, 0.284581516, 0.391396659, 0.225144559, 0.322000862, 1, 0.855653388, 0.473149488, 0.382865989, 0.416158222, 0.34964929, 0.001648807, 0.792477789, 0.875891916],
    [ -0.005090846, 0.113717428, 0.293670641, 0.60930742, 0.672938853, -0.312647195, -0.197523176, 0.659266498, 0.571936997, 0.638785467, 0.207250123, 0.318716399, 0.149560634, 0.250969646, 0.855653388, 1, 0.480639777, 0.634927547, 0.422198588, 0.604631228, -0.371033922, 0.631133943, 0.69292112],
    [0.07477263, 0.035302896, 0.23453535, 0.257546419, 0.282296878, -0.215576109, -0.234574405, 0.283535046, 0.234090323, 0.259827568, 0.676016451, 0.749692725, 0.541673874, 0.606171481, 0.473149488, 0.480639777, 1, 0.820347933, 0.867971871, 0.724873514, -0.233829866, 0.402928385, 0.306342787],
    [0.078667159, -0.06984772, 0.204300778, 0.111711434, 0.147689932, -0.551626215, -0.461261728, 0.137941771, 0.076217356, 0.11520273, 0.496863446, 0.56591734, 0.378939516, 0.441395312, 0.382865989, 0.634927547, 0.820347933, 1, 0.710139796, 0.915463136, -0.597825051, 0.246329892, 0.170467219],
    [ 0.056617276, 0.053981204, 0.27178506, 0.20094303, 0.228524712, -0.169559089, -0.190218418, 0.241602847, 0.181581637, 0.208577168, 0.550935705, 0.623214707, 0.665520863, 0.742936829, 0.416158222, 0.422198588, 0.867971871, 0.710139796, 1, 0.806674748, -0.19294317, 0.35295872, 0.261932583],
    [ 0.064182136, -0.050681711, 0.236958882, 0.074228811, 0.114022752, -0.523255959, -0.431020317, 0.114922688, 0.041649415, 0.083754306, 0.396325292, 0.466366361, 0.477956743, 0.550707093, 0.34964929, 0.604631228, 0.724873514, 0.915463136, 0.806674748, 1, -0.574296642, 0.216947213, 0.145285479],
    [ -0.062017348, 0.456577608, 0.093382455, 0.364607193, 0.335408175, 0.962550066, 0.88573322, 0.387175456, 0.42267961, 0.391948715, 0.219786814, 0.201543093, 0.265412117, 0.247454581, 0.001648807, -0.371033922, -0.233829866, -0.597825051, -0.19294317, -0.574296642, 1, 0.325419971, 0.331338721],
    [ -0.025807721, 0.424759669, 0.321539451, 0.840245342, 0.880133867, 0.358823653, 0.413549443, 0.913184911, 0.850440798, 0.893436341, 0.480582062, 0.585314249, 0.428768399, 0.522001384, 0.792477789, 0.631133943, 0.402928385, 0.246329892, 0.35295872, 0.216947213, 0.325419971, 1, 0.899691233],
    [ -0.035230902, 0.335995307, 0.323802347, 0.932678657, 0.981607364, 0.364752206, 0.41543595, 0.985587773, 0.916604847, 0.966722063, 0.370159735, 0.47645679, 0.321115768, 0.419011086, 0.875891916, 0.69292112, 0.306342787, 0.170467219, 0.261932583, 0.145285479, 0.331338721, 0.899691233, 1]
];

var data = [];
for (var i = 0; i < featureNames.length; i++) {
    for (var j = 0; j < featureNames.length; j++) {
        data.push([i, j, correlationCoefficients[i][j]]);
    }
}

option1 = {
    title: {
        text: '特征因子相关系数矩阵', 
        left: 'center', 
        top: 'top',
        left: '39%', 
        textStyle: {
            fontSize: '18',
            color: '#44EAFC', 
            fontWeight: '600' 
        }
    },
    tooltip: {
        position: 'top',
        trigger: 'item', // 设置触发方式为item，即鼠标悬停时触发
        formatter: function(params) {
            return '特征名称：' + featureNames[params.value[0]] + '<br/>' + '特征名称：' + featureNames[params.value[1]] + '<br/>' + '斯皮尔曼相关系数：' + params.value[2];
        }
    },
    animation: false,
    grid: {
        height: '65%',
        top: '7%',
        left: '23%'
    },
    xAxis: {
        type: 'category',
        data: featureNames,
        splitArea: {
            show: true
        },
        axisLabel: {
            interval: 0,
            rotate: 90
        },
        textStyle:{
          color:'#c4c4c4'
        }
    },
    yAxis: {
        type: 'category',
        data: featureNames,
        splitArea: {
            show: true
        },
        axisLabel: {
            interval: 0,
            rotate: 0
        },
        textStyle:{
          color:'#c4c4c4'
        }
    },
    visualMap: {
        min: -0.3,
        max: 1,
        // text: ['1', '-0.3'],
        textStyle:{color:'#fff'},
        // calculable: true,
        orient: 'horizontal',
        left: 'center',
        bottom: 'bottom',
        // inRange: {
        //     color: ['#50a3ba', '#eac736', '#d94e5d']
        // }
    },
    series: [{
        name: 'Correlation Coefficient',
        type: 'heatmap',
        data: data,
        label: {
            show: false
        },
        itemStyle: {
            emphasis: {
                shadowBlur: 10,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
          }
    }]
};

chart1.setOption(option1);
    })();
})